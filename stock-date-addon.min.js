(function(){'use strict';const CONFIG={dateElementId: 'stock-update-date',heroSelector: '.hero-content',dateFormat: 'DD/MM/YYYY',fallbackToCurrentDate: true,retryAttempts: 3,retryDelay: 1000};const TEXTS={en:{lastUpdated: 'Last updated:',loading: 'Loading...',unavailable: 'Date unavailable'},es:{lastUpdated: 'Última actualización:',loading: 'Cargando...',unavailable: 'Fecha no disponible'}};function getCurrentLanguage(){const savedLang=localStorage.getItem('selectedLanguage');if(savedLang)return savedLang;const htmlLang=document.documentElement.lang;if(htmlLang)return htmlLang.substring(0,2);return 'en';}function getText(key){const lang=getCurrentLanguage();return TEXTS[lang]&&TEXTS[lang][key] ? TEXTS[lang][key] : TEXTS.en[key];}function formatDate(date){const day=date.getDate().toString().padStart(2,'0');const month=(date.getMonth()+1).toString().padStart(2,'0');const year=date.getFullYear();return `${day}/${month}/${year}`;}function createDateElement(){const dateContainer=document.createElement('div');dateContainer.className='hero-date-info';dateContainer.innerHTML=`<span class="date-label">${getText('lastUpdated')}</span><span id="${CONFIG.dateElementId}" class="date-value">${getText('loading')}</span>`;return dateContainer;}function injectCSS(){const css=` .hero-date-info{margin-top: 1rem;display: flex;align-items: center;justify-content: center;gap: 0.5rem;font-size: 0.9rem;color: #64748b;animation: fadeIn 0.5s ease-in;}.hero-date-info .date-label{font-weight: 500;}.hero-date-info .date-value{font-weight: 600;color: #00B04F;background: rgba(0,176,79,0.1);padding: 0.25rem 0.75rem;border-radius: 20px;border: 1px solid rgba(0,176,79,0.2);transition: all 0.3s ease;}.hero-date-info .date-value:hover{background: rgba(0,176,79,0.15);transform: translateY(-1px);}@keyframes fadeIn{from{opacity: 0;transform: translateY(10px);}to{opacity: 1;transform: translateY(0);}}@media(max-width: 768px){.hero-date-info{flex-direction: column;gap: 0.25rem;font-size: 0.8rem;}}`;const style=document.createElement('style');style.textContent=css;document.head.appendChild(style);}async function getDateFromHeaders(){try{const response=await fetch('stock_data.json',{method: 'HEAD',cache: 'no-cache'});const lastModified=response.headers.get('Last-Modified');if(lastModified){return new Date(lastModified);}throw new Error('Last-Modified header not found');}catch(error){console.warn('Stock Date Addon: Could not get date from headers:',error.message);return null;}}async function getDateFromJSON(){try{const response=await fetch('stock_data.json',{cache: 'no-cache'});const data=await response.json();if(data.metadata&&data.metadata.lastUpdated){return new Date(data.metadata.lastUpdated);}return null;}catch(error){console.warn('Stock Date Addon: Could not get date from JSON:',error.message);return null;}}async function updateStockDate(attempt=1){const dateElement=document.getElementById(CONFIG.dateElementId);if(!dateElement)return;try{let date=await getDateFromJSON();if(!date){date=await getDateFromHeaders();}if(!date&&CONFIG.fallbackToCurrentDate){date=new Date();console.info('Stock Date Addon: Using current date as fallback');}if(date){dateElement.textContent=formatDate(date);dateElement.style.color='#00B04F';}else{throw new Error('No date source available');}}catch(error){console.error('Stock Date Addon: Error updating date:',error.message);if(attempt<CONFIG.retryAttempts){setTimeout(()=>{updateStockDate(attempt+1);},CONFIG.retryDelay);return;}dateElement.textContent=getText('unavailable');dateElement.style.color='#ef4444';}}function injectDateElement(){const heroContent=document.querySelector(CONFIG.heroSelector);if(!heroContent){console.warn('Stock Date Addon: Hero section not found');return false;}if(document.getElementById(CONFIG.dateElementId)){return true;}const dateElement=createDateElement();heroContent.appendChild(dateElement);return true;}function updateLanguage(){const labelElement=document.querySelector('.hero-date-info .date-label');if(labelElement){labelElement.textContent=getText('lastUpdated');}}function init(){injectCSS();if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{setTimeout(()=>{if(injectDateElement()){updateStockDate();}},100);});}else{setTimeout(()=>{if(injectDateElement()){updateStockDate();}},100);}document.addEventListener('languageChanged',updateLanguage);if(window.addEventListener){window.addEventListener('storage',function(e){if(e.key==='selectedLanguage'){updateLanguage();}});}}window.StockDateAddon={update: updateStockDate,updateLanguage: updateLanguage};init();})();